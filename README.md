# Data_processing
## Version 1
### 1.csv导入格式

CSV 导入功能主要由 `CSVImportManager` 负责解析和处理

------

#### ✅  CSV 文件格式要求如下：

##### 📄 标准格式（6 列）：

| 列号 | 字段名       | 数据类型              | 说明                                                  |
| ---- | ------------ | --------------------- | ----------------------------------------------------- |
| 1    | ID           | 字符串                | 每条交易的唯一标识符（如 UUID）。如果为空也可自动生成 |
| 2    | DateTime     | 日期时间字符串        | 格式要求为：`yyyy-MM-dd HH:mm:ss`                     |
| 3    | CategoryID   | 整数                  | 必须是你系统中已有的类别 ID                           |
| 4    | CategoryType | `INCOME` 或 `EXPENSE` | 区分类别的类型                                        |
| 5    | Amount       | 小数（最多两位小数）  | 金额，必须 > 0                                        |
| 6    | Description  | 字符串                | 可选说明（可以包含英文逗号，需要用双引号括起）        |

------

##### 🧪 示例内容：

```csv
ID,DateTime,CategoryID,CategoryType,Amount,Description
abc123,2024-04-20 14:30:00,1,EXPENSE,36.50,"午餐外卖"
def456,2024-04-20 18:00:00,2,EXPENSE,88.88,"服装购物"
ghi789,2024-04-21 10:00:00,8,INCOME,5000.00,"工资发放"
```

------

##### 🧱 必须满足的格式细节：

| 要求           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| ✅ 日期时间格式 | `2024-04-20 14:30:00`，**必须精确到秒**，并符合 `yyyy-MM-dd HH:mm:ss` |
| ✅ 类别 ID      | 需要是系统中通过 `CategoryManager` 注册过的类别 ID           |
| ✅ 类别类型     | 必须为大写 `INCOME` 或 `EXPENSE`，匹配枚举 `CategoryType.valueOf(...)` |
| ✅ 金额         | 是 BigDecimal 类型，可带小数，不能为负或为零                 |
| ✅ 描述         | 可为空；如果含有逗号，需要用英文双引号 `"` 包裹，内部 `"` 要转义为 `""` |

------

##### ⚠️ 错误示例（不符合格式的情况）：

```csv
ID,DateTime,CategoryID,CategoryType,Amount,Description
abc123,2024-4-20 14:30,1,EXPENSE,36.50,"格式错误的日期"         ← 错 ❌
def456,2024-04-20 18:00:00,99,EXPENSE,88.88,"无效类别 ID"        ← 错 ❌
ghi789,2024-04-21 10:00:00,2,Food,5000.00,"类型拼写错误"        ← 错 ❌
```

------

#### ✅ 导入失败时会发生什么？

- `parseTransaction()` 中会捕捉 `Exception` 并输出错误到控制台（不会终止导入流程）。
- 某一行解析失败只会**跳过该行**，不会影响其他数据。
- 如果 `categoryId` 在系统中找不到，会创建一个 `"未知类别"` 并添加到系统中。

### 2.去重逻辑

| 条件                              | 是否会被认为是“重复记录”       |
| --------------------------------- | ------------------------------ |
| `ID` 完全相同                     | ✅ 会被排除                     |
| 时间/金额/描述一样，但 ID 不同    | ❌ 不会被排除（认为是不同交易） |
| 多行数据没有 ID（或 ID 自动生成） | 每行都会被认为是新交易 ✅       |

### 3. 数据预处理逻辑

| 目标                         | 说明                                          |
| ---------------------------- | --------------------------------------------- |
| 1️⃣ 去重                       | 避免导入重复的交易记录（一般通过 `ID` 实现）  |
| 2️⃣ 格式标准化（格式化）       | 确保金额统一为 2 位小数，描述去掉换行、空格等 |
| 3️⃣ 最终生成「干净可用的数据」 | 然后才加入系统并保存到 `transactions.csv`     |

### 4. 下一阶段迭代安排
优先级 | 功能
高 | 缺失字段的智能补全（分类+时间）
高 | 导入成功/失败提示 & 日志
中 | 分类推荐（规则 or 关键词）
中 | UI 支持排序、搜索
中 | AI 分类模块 + 多用户支持
